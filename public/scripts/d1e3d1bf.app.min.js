"use strict";angular.module("luciandipeso.wl",["config","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","chieffancypants.loadingBar","infinite-scroll","angularMoment","google-maps"]).constant("version","v0.1.0").run(["settings",function(a){var b=angular.element("head");b.append('<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="'+a.apiBase+'/feeds/posts">')}]).config(function(a,b){a.html5Mode(!1),b.when("/",{templateUrl:"views/home.html"}).when("/post/:id",{controller:"PostCtrl",templateUrl:"views/post.html"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"})}),angular.module("config",[]).constant("settings",{apiBase:"http://whereslucian.com:8080"}),angular.module("luciandipeso.wl").controller("MainCtrl",["$scope","$location","$http","$q","PostFactory","version","settings",function(a,b,c,d,e,f){a.$path=b.path.bind(b),a.version=f,a.pm=new e}]),angular.module("luciandipeso.wl").controller("PostCtrl",["$scope","$location","$http","$q","$routeParams","PostFactory","version","settings",function(a,b,c,d,e,f,g){a.$path=b.path.bind(b),a.version=g,a.item={},a.pm=new f,a.pm.getPost(e.id).then(function(b){a.item=b})}]),angular.module("luciandipeso.wl").factory("PostFactory",["$http","$q","settings",function(a,b,c){var d=function(){this.items=[],this.currentPage=0,this.stop=!1,this.busy=!1},e=function(a){this.id=a.id||0,this.title=a.title||"",this.author=a.author||"",this.subtitle=a.subtitle||"",this.type=a.type||"essay",this.dateAdded=a.dateAdded||new Date,this.dateUpdated=a.dateUpdated||new Date,this.lat=a.lat||null,this.lng=a.lng||null,this.latlng=a.lat&&a.lng?a.lat+", "+a.lng:null;var b=$("<div>"+(a.post||"")+"</div>");b.find(".article-sidenote").wrapInner('<span class="contents"></span>').prepend("<sub>â†ª</sub>"),this.post=b.html(),this.postlets=[],this.citations=[],this.map=!1,this.mapObject={marker:!1};for(var c=0,d=a.postlets.length;d>c;c++)this.postlets.push(new f(a.postlets[c]));for(c=0,d=a.citations.length;d>c;c++)this.citations.push(new g(a.citations[c]));if(this.showPostlet=function(a){this.map&&this.map.addMarker(a);for(var b=0,c=this.postlets.length;c>b;b++)this.postlets[b].visible=!1;this.postlets[a].visible=!0},this.postlets.length&&this.postlets[0].hasCoords())for(this.map={addMarker:function(a){this.mapObject.marker&&(this.mapObject.marker.setMap(null),this.mapObject.marker=!1);var b=this.postlets[a],c=this.mapObject.getGMap();b&&b.hasCoords()&&c&&(this.mapObject.marker=new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lng),map:c,animation:google.maps.Animation.DROP}),this.mapObject.refresh({latitude:b.lat,longitude:b.lng}))}.bind(this),center:{latitude:this.postlets[0].lat,longitude:this.postlets[0].lng},zoom:10,postletLatLngs:[],postlets:[],stroke:{color:"#C23700",weight:4,opacity:.8}},c=0,d=this.postlets.length;d>c;c++)this.postlets[c].hasCoords()&&(this.map.postlets.push(this.postlets[c]),this.map.postletLatLngs.push({latitude:this.postlets[c].lat,longitude:this.postlets[c].lng}))},f=function(a){this.id=a.id,this.dateAdded=a.dateAdded||new Date,this.lat=a.lat||null,this.lng=a.lng||null,this.post=a.post||"",this.visible=!1,this.hasCoords=function(){return this.lng&&this.lat}},g=function(a){this.id=a.id,this.citation=a.citation};return d.prototype.nextPage=function(){if(!this.stop&&!this.busy){this.busy=!0;var a=this.currentPage+1;this.getPosts(a).then(function(b){var c=0,d=b.length;if(!d)return void(this.stop=!0);for(;d>c;c++)this.items.push(b[c]);this.currentPage=a,this.busy=!1}.bind(this))}},d.prototype.getPost=function(d){var f=URI(c.apiBase+"/post/"+d);f.search({callback:"JSON_CALLBACK"});var g=b.defer();return a.jsonp(f.toString()).success(function(a){try{g.resolve(new e(a.record))}catch(b){g.reject("Fail to query server for posts. "+b)}}.bind(this)).error(function(a,b,c,d){console.debug("Error",a,b,c,d)}),g.promise},d.prototype.getPosts=function(d){var f=URI(c.apiBase+"/posts/"+d);f.search({callback:"JSON_CALLBACK"});var g=b.defer();return a.jsonp(f.toString()).success(function(a){try{for(var b=0,c=a.records.length,d=[];c>b;b++)d.push(new e(a.records[b]));g.resolve(d)}catch(f){g.reject("Fail to query server for posts. "+f)}}.bind(this)).error(function(a,b,c,d){console.debug("Error",a,b,c,d)}),g.promise},d}]);